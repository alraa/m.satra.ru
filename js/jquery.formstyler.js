!function(e){e.fn.styler=function(s){var t=e.extend({wrapper:"form",idSuffix:"-styler",filePlaceholder:"Загрузить документ",fileBrowse:"Загрузить",selectSearch:!0,selectSearchLimit:30,selectSearchNotFound:"Совпадений не найдено",selectSearchPlaceholder:"Поиск...",selectVisibleOptions:0,singleSelectzIndex:"100",selectSmartPositioning:!1,onSelectOpened:function(){},onSelectClosed:function(){},onFormStyled:function(){}},s);return this.each(function(){function s(){var e="",s="",i="",o="";void 0!==l.attr("id")&&""!==l.attr("id")&&(e=' id="'+l.attr("id")+t.idSuffix+'"'),void 0!==l.attr("title")&&""!==l.attr("title")&&(s=' title="'+l.attr("title")+'"'),void 0!==l.attr("class")&&""!==l.attr("class")&&(i=" "+l.attr("class"));for(var c=l.data(),n=0;n<c.length;n++)""!==c[n]&&(o+=" data-"+n+'="'+c[n]+'"');e+=o,this.id=e,this.title=s,this.classes=i}var l=e(this);l.is(":checkbox")?l.each(function(){if(l.parent("div.jq-checkbox").length<1){var t=function(){var t=new s,i=e("<div"+t.id+' class="jq-checkbox'+t.classes+'"'+t.title+'><div class="jq-checkbox__div"></div></div>');l.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(i).prependTo(i),i.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative",overflow:"hidden"}),l.is(":checked")&&i.addClass("checked"),l.is(":disabled")&&i.addClass("disabled"),i.on("click.styler",function(){return i.is(".disabled")?!1:(l.is(":checked")?(l.prop("checked",!1),i.removeClass("checked")):(l.prop("checked",!0),i.addClass("checked")),l.change(),!1)}),l.closest("label").add('label[for="'+l.attr("id")+'"]').click(function(e){i.click(),e.preventDefault()}),l.on("change.styler",function(){l.is(":checked")?i.addClass("checked"):i.removeClass("checked")}).on("keydown.styler",function(e){32==e.which&&i.click()}).on("focus.styler",function(){i.is(".disabled")||i.addClass("focused")}).on("blur.styler",function(){i.removeClass("focused")})};t(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),t()})}}):l.is(":radio")?l.each(function(){if(l.parent("div.jq-radio").length<1){var i=function(){var i=new s,o=e("<div"+i.id+' class="jq-radio'+i.classes+'"'+i.title+'><div class="jq-radio__div"></div></div>');l.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(o).prependTo(o),o.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative"}),l.is(":checked")&&o.addClass("checked"),l.is(":disabled")&&o.addClass("disabled"),o.on("click.styler",function(){return o.is(".disabled")?!1:(o.closest(t.wrapper).find('input[name="'+l.attr("name")+'"]').prop("checked",!1).parent().removeClass("checked"),l.prop("checked",!0).parent().addClass("checked"),l.change(),!1)}),l.closest("label").add('label[for="'+l.attr("id")+'"]').click(function(e){o.click(),e.preventDefault()}),l.on("change.styler",function(){l.parent().addClass("checked")}).on("focus.styler",function(){o.is(".disabled")||o.addClass("focused")}).on("blur.styler",function(){o.removeClass("focused")})};i(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),i()})}}):l.is(":file")?l.css({position:"absolute",top:0,right:0,width:"100%",height:"100%",opacity:0,margin:0,padding:0}).each(function(){if(l.parent("div.jq-file").length<1){var i=function(){var i=new s,o=e("<div"+i.id+' class="jq-file'+i.classes+'"'+i.title+' style="display: inline-block; position: relative; overflow: hidden"></div>'),c=e('<div class="jq-file__name">'+t.filePlaceholder+"</div>").appendTo(o);e('<div class="jq-file__browse">'+t.fileBrowse+"</div>").appendTo(o);l.after(o),o.append(l),l.is(":disabled")&&o.addClass("disabled"),l.on("change.styler",function(){var e=l.val();if(l.is("[multiple]")){e="";for(var s=l[0].files,i=0;i<s.length;i++)e+=(i>0?", ":"")+s[i].name}c.text(e.replace(/.+[\\\/]/,"")),""===e?(c.text(t.filePlaceholder),o.removeClass("changed")):o.addClass("changed")}).on("focus.styler",function(){o.addClass("focused")}).on("blur.styler",function(){o.removeClass("focused")}).on("click.styler",function(){o.removeClass("focused")})};i(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),i()})}}):l.is("select")?l.each(function(){if(l.parent("div.jqselect").length<1){var o=function(){function o(s){s.off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(s){var t=null;"mousewheel"==s.type?t=-1*s.originalEvent.wheelDelta:"DOMMouseScroll"==s.type&&(t=40*s.originalEvent.detail),t&&(s.stopPropagation(),s.preventDefault(),e(this).scrollTop(t+e(this).scrollTop()))})}function c(){for(i=0,len=d.length;i<len;i++){var e="",s="",t="",l="",o="",c="",n="disabled",a="selected sel disabled";d.eq(i).prop("selected")&&(s="selected sel"),d.eq(i).is(":disabled")&&(s=n),d.eq(i).is(":selected:disabled")&&(s=a),void 0!==d.eq(i).attr("class")&&(l=" "+d.eq(i).attr("class"),c=' data-jqfs-class="'+d.eq(i).attr("class")+'"');var h=d.eq(i).data();for(var f in h)""!==h[f]&&(t+=" data-"+f+'="'+h[f]+'"');e="<li"+c+t+' class="'+s+l+'">'+d.eq(i).text()+"</li>",d.eq(i).parent().is("optgroup")&&(void 0!==d.eq(i).parent().attr("class")&&(o=" "+d.eq(i).parent().attr("class")),e="<li"+c+' class="'+s+l+" option"+o+'">'+d.eq(i).text()+"</li>",d.eq(i).is(":first-child")&&(e='<li class="optgroup'+o+'">'+d.eq(i).parent().attr("label")+"</li>"+e)),r+=e}}function n(){var i=new s,n=e("<div"+i.id+' class="jq-selectbox jqselect'+i.classes+'" style="display: inline-block; position: relative; z-index:'+t.singleSelectzIndex+'"><div class="jq-selectbox__select"'+i.title+' style="position: relative"><div class="jq-selectbox__select-text"></div><div class="jq-selectbox__trigger"><div class="jq-selectbox__trigger-arrow"></div></div></div></div>');l.css({margin:0,padding:0}).after(n).prependTo(n);var a=e("div.jq-selectbox__select",n),h=e("div.jq-selectbox__select-text",n),f=d.filter(":selected");f.length?h.html(f.text()):h.html(d.first().text()),c();var p="";t.selectSearch&&(p='<div class="jq-selectbox__search"><input type="search" autocomplete="off" placeholder="'+t.selectSearchPlaceholder+'"></div><div class="jq-selectbox__not-found">'+t.selectSearchNotFound+"</div>");var u=e('<div class="jq-selectbox__dropdown" style="position: absolute">'+p+'<ul style="position: relative; list-style: none; overflow: auto; overflow-x: hidden">'+r+"</ul></div>");n.append(u);var v=e("ul",u),g=e("li",u),b=e("input",u),m=e("div.jq-selectbox__not-found",u).hide();g.length<t.selectSearchLimit&&b.parent().hide();var y=0,x=0;g.each(function(){var s=e(this);s.css({display:"inline-block","white-space":"nowrap"}),s.innerWidth()>y&&(y=s.innerWidth(),x=s.width()),s.css({display:"block"})});var w=n.clone().appendTo("body").width("auto"),C=w.width();w.remove(),C==n.width()&&(h.width(x),y+=n.find("div.jq-selectbox__trigger").width()),y>n.width()&&u.width(y),l.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0});var q=n.outerHeight(),k=b.outerHeight(),j=v.css("max-height"),_=g.filter(".selected");_.length<1&&g.first().addClass("selected sel"),void 0===g.data("li-height")&&g.data("li-height",g.outerHeight());var S=u.css("top");if("auto"==u.css("left")&&u.css({left:0}),"auto"==u.css("top")&&u.css({top:q}),u.hide(),_.length&&(d.first().text()!=f.text()&&n.addClass("changed"),n.data("jqfs-class",_.data("jqfs-class")),n.addClass(_.data("jqfs-class"))),l.is(":disabled"))return n.addClass("disabled"),!1;a.click(function(){l.focus(),e("div.jq-selectbox").filter(".opened").length&&t.onSelectClosed.call(e("div.jq-selectbox").filter(".opened"));var s=g.data("li-height");if(t.selectSmartPositioning){var i=e(window),c=n.offset().top,a=i.height()-q-(c-i.scrollTop()),d=t.selectVisibleOptions,r=5*s,h=s*d;if(d>0&&6>d&&(r=h),0===d&&(h="auto"),a>r+k+20){u.height("auto").css({bottom:"auto",top:S});var f=function(){v.css("max-height",Math.floor(a/s)*s+43)};f(),v.css("max-height",h),"none"!=j&&v.css("max-height",j),a<u.outerHeight()+20&&f()}else{u.height("auto").css({top:"auto",bottom:S});var p=function(){v.css("max-height",Math.floor((c-i.scrollTop())/s)*s)};p(),v.css("max-height",h),"none"!=j&&v.css("max-height",j),c-i.scrollTop()-20<u.outerHeight()+20&&p()}}return e("div.jqselect").css({zIndex:t.singleSelectzIndex-1}).removeClass("opened"),n.css({zIndex:t.singleSelectzIndex}),u.is(":hidden")?(e("div.jq-selectbox__dropdown:visible").hide(),u.show(),n.addClass("opened focused"),t.onSelectOpened.call(n)):(u.hide(),n.removeClass("opened"),e("div.jq-selectbox").filter(".opened").length&&t.onSelectClosed.call(n)),g.filter(".selected").length&&(v.innerHeight()/s%2!==0&&(s/=2),v.scrollTop(v.scrollTop()+g.filter(".selected").position().top-v.innerHeight()/2+s)),b.length&&(b.val("").keyup(),m.hide(),b.keyup(function(){var s=e(this).val();g.each(function(){e(this).html().match(new RegExp(".*?"+s+".*?","i"))?e(this).show():e(this).hide()}),g.filter(":visible").length<1?m.show():m.hide()})),o(v),!1}),g.hover(function(){e(this).siblings().removeClass("selected")});var T=g.filter(".selected").text();g.filter(".selected").text();g.filter(":not(.disabled):not(.optgroup)").click(function(){var s=e(this),i=s.text();if(T!=i){var o=s.index();o-=s.prevAll(".optgroup").length,s.addClass("selected sel").siblings().removeClass("selected sel"),d.prop("selected",!1).eq(o).prop("selected",!0),T=i,h.html(i),n.data("jqfs-class")&&n.removeClass(n.data("jqfs-class")),n.data("jqfs-class",s.data("jqfs-class")),n.addClass(s.data("jqfs-class")),l.change()}b.length&&(b.val("").keyup(),m.hide()),u.hide(),n.removeClass("opened"),t.onSelectClosed.call(n)}),u.mouseout(function(){e("li.sel",u).addClass("selected")}),l.on("change.styler",function(){h.html(d.filter(":selected").text()),g.removeClass("selected sel").not(".optgroup").eq(l[0].selectedIndex).addClass("selected sel"),d.first().text()!=g.filter(".selected").text()?n.addClass("changed"):n.removeClass("changed")}).on("focus.styler",function(){n.addClass("focused"),e("div.jqselect").removeClass("opened")}).on("blur.styler",function(){n.removeClass("focused")}).on("keydown.styler keyup.styler",function(e){var s=g.data("li-height");h.html(d.filter(":selected").text()),g.removeClass("selected sel").not(".optgroup").eq(l[0].selectedIndex).addClass("selected sel"),(38==e.which||37==e.which||33==e.which||36==e.which)&&v.scrollTop(v.scrollTop()+g.filter(".selected").position().top),(40==e.which||39==e.which||34==e.which||35==e.which)&&v.scrollTop(v.scrollTop()+g.filter(".selected").position().top-v.innerHeight()+s),32==e.which&&e.preventDefault(),13==e.which&&(e.preventDefault(),u.hide())}),e(document).on("click",function(s){e(s.target).parents().hasClass("jq-selectbox")||"OPTION"==s.target.nodeName||(e("div.jq-selectbox").filter(".opened").length&&t.onSelectClosed.call(e("div.jq-selectbox").filter(".opened")),b.length&&b.val("").keyup(),u.hide().find("li.sel").addClass("selected"),n.removeClass("focused opened"))})}function a(){var t=new s,i=e("<div"+t.id+' class="jq-select-multiple jqselect'+t.classes+'"'+t.title+' style="display: inline-block; position: relative"></div>');l.css({margin:0,padding:0}).after(i),c(),i.append("<ul>"+r+"</ul>");var n=e("ul",i).css({position:"relative","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"}),a=e("li",i).attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none","white-space":"nowrap"}),h=l.attr("size"),f=n.outerHeight(),p=a.outerHeight();void 0!==h&&h>0?n.css({height:p*h}):n.css({height:4*p}),f>i.height()&&(n.css("overflowY","scroll"),o(n),a.filter(".selected").length&&n.scrollTop(n.scrollTop()+a.filter(".selected").position().top)),l.prependTo(i).css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0}),l.is(":disabled")?(i.addClass("disabled"),d.each(function(){e(this).is(":selected")&&a.eq(e(this).index()).addClass("selected")})):(a.filter(":not(.disabled):not(.optgroup)").click(function(s){l.trigger("focus.styler"),i.removeClass("focused");var t=e(this);if(s.ctrlKey||s.metaKey||t.addClass("selected"),s.shiftKey||t.addClass("first"),s.ctrlKey||s.metaKey||s.shiftKey||t.siblings().removeClass("selected first"),(s.ctrlKey||s.metaKey)&&(t.is(".selected")?t.removeClass("selected first"):t.addClass("selected first"),t.siblings().removeClass("first")),s.shiftKey){var o=!1,c=!1;t.siblings().removeClass("selected").siblings(".first").addClass("selected"),t.prevAll().each(function(){e(this).is(".first")&&(o=!0)}),t.nextAll().each(function(){e(this).is(".first")&&(c=!0)}),o&&t.prevAll().each(function(){return e(this).is(".selected")?!1:void e(this).not(".disabled, .optgroup").addClass("selected")}),c&&t.nextAll().each(function(){return e(this).is(".selected")?!1:void e(this).not(".disabled, .optgroup").addClass("selected")}),1==a.filter(".selected").length&&t.addClass("first")}d.prop("selected",!1),a.filter(".selected").each(function(){var s=e(this),t=s.index();s.is(".option")&&(t-=s.prevAll(".optgroup").length),d.eq(t).prop("selected",!0)}),l.trigger("change.styler")}),d.each(function(s){e(this).data("optionIndex",s)}),l.on("change.styler",function(){a.removeClass("selected");var s=[];d.filter(":selected").each(function(){s.push(e(this).data("optionIndex"))}),a.not(".optgroup").filter(function(t){return e.inArray(t,s)>-1}).addClass("selected")}).on("focus.styler",function(){i.addClass("focused")}).on("blur.styler",function(){i.removeClass("focused")}),f>i.height()&&l.on("keydown.styler",function(e){(38==e.which||37==e.which||33==e.which)&&n.scrollTop(n.scrollTop()+a.filter(".selected").position().top-p),(40==e.which||39==e.which||34==e.which)&&n.scrollTop(n.scrollTop()+a.filter(".selected:last").position().top-n.innerHeight()+2*p)}))}var d=e("option",l),r="";l.is("[multiple]")?a():n()};o(),l.on("refresh",function(){l.off(".styler").parent().before(l).remove(),o()})}}):l.is(":reset")&&l.on("click",function(){setTimeout(function(){l.closest(t.wrapper).find("input, select").trigger("refresh")},1)})}).promise().done(function(){t.onFormStyled.call()})}}(jQuery);